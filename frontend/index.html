<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Arunand's Aviation ERP</title>
  <link rel="stylesheet" href="/style.css" />
</head>

<body>
  <div id="homeRoot" class="home-root">
    <button class="hamburger home-hamburger" onclick="toggleSidebar('home')" aria-label="Toggle home menu">☰</button>
    <aside class="home-sidebar">
      <div class="brand">
        <div class="logo-wrap">
          <img src="/assets/logo.png" alt="AAI" class="logo-img" />
        </div>
        <div>
          <div class="brand-title">Arunand's Aviation Institute</div>
          <div class="brand-sub">Fly Beyond The Sky</div>
        </div>
      </div>
      <button class="nav-item active" onclick="openPortal('student')">Student Portal</button>
      <button class="nav-item" onclick="openPortal('staff')">Staff Portal</button>
      <button class="nav-item" onclick="showAdmissionForm()">Admission Form</button>
    </aside>
    <main class="home-main">
      <section id="homeWelcome" class="panel">
        <h1>Welcome To Arunand's Aviation Institute</h1>
        <p>Industry-focused training for Ground Operations and Cabin Crew careers.</p>
        <div class="home-actions">
          <button class="btn primary" onclick="showAdmissionForm()">Apply For Admission</button>
          <button class="btn" onclick="openPortal('student')">Open Student Portal</button>
        </div>
      </section>
      <section class="panel">
        <div class="panel-header">
          <h2>About Us</h2>
        </div>
        <p class="meta">
          Arunand's Aviation Institute provides practical aviation training with structured attendance tracking,
          performance monitoring, and fee management through an integrated ERP platform.
        </p>
      </section>
      <section class="panel">
        <div class="panel-header">
          <h2>Proud Alumni</h2>
          <button class="btn" onclick="loadProudAlumni()">Refresh</button>
        </div>
        <ul id="alumniList" class="student-list">
          <li class="student-item"><strong>No alumni updates yet</strong></li>
        </ul>
      </section>
      <section id="homeAdmission" class="panel hidden">
        <div class="panel-header">
          <h2>Admission Form</h2>
        </div>
        <div class="panel-header">
          <h2>Student Details</h2>
        </div>
        <div class="form-row">
          <input id="admissionFirstName" placeholder="First Name" />
          <input id="admissionMiddleName" placeholder="Middle Name" />
          <input id="admissionLastName" placeholder="Last Name" />
          <input id="admissionPhone" placeholder="Mobile Number" />
          <input id="admissionEmail" placeholder="Email ID" />
          <input id="admissionBloodGroup" placeholder="Blood Group" />
          <input id="admissionAge" type="number" min="1" placeholder="Age" />
          <input id="admissionDob" type="date" placeholder="Date Of Birth" />
          <input id="admissionAadhaar" placeholder="Aadhaar Number" />
          <input id="admissionNationality" placeholder="Nationality" />
          <select id="admissionCourse">
            <option value="">Select Course</option>
            <option value="Ground Operations">Ground Operations</option>
            <option value="Cabin Crew">Cabin Crew</option>
          </select>
        </div>

        <div class="panel-header">
          <h2>Father Details</h2>
        </div>
        <div class="form-row">
          <input id="fatherName" placeholder="Father Name" />
          <input id="fatherPhone" placeholder="Father Mobile Number" />
          <input id="fatherOccupation" placeholder="Father Occupation" />
          <input id="fatherEmail" placeholder="Father Email ID" />
        </div>

        <div class="panel-header">
          <h2>Mother Details</h2>
        </div>
        <div class="form-row">
          <input id="motherName" placeholder="Mother Name" />
          <input id="motherPhone" placeholder="Mother Mobile Number" />
          <input id="motherOccupation" placeholder="Mother Occupation" />
          <input id="motherEmail" placeholder="Mother Email ID" />
        </div>

        <div class="panel-header">
          <h2>Address Details</h2>
        </div>
        <div class="form-row">
          <input id="correspondenceAddress" placeholder="Address For Correspondence" />
          <input id="permanentAddress" placeholder="Permanent Address" />
        </div>

        <div class="panel-header">
          <h2>Academic Details</h2>
          <button type="button" class="btn" onclick="addAcademicRow()">Add Row</button>
        </div>
        <div id="academicRows" class="academic-rows"></div>

        <div class="home-actions">
          <button class="btn primary" onclick="submitAdmissionForm()">Submit</button>
        </div>
      </section>
    </main>
  </div>

  <div id="loginRoot" class="login-root hidden">
    <div class="login-card">
      <div class="brand-mark">
        <img src="/assets/logo.png" alt="Arunand's Aviation Institute" class="logo-img" />
      </div>
      <h1 id="portalTitle">Login</h1>
      <p id="portalSubtitle">Use your student ID or superuser</p>
      <input id="loginUser" list="studentLoginList" placeholder="Username" />
      <datalist id="studentLoginList"></datalist>
      <input id="loginPass" type="password" placeholder="Password" />
      <button class="btn primary" onclick="handleLogin()">Sign In</button>
      <button class="btn" onclick="showHome()">Back</button>
      <div id="loginError" class="login-error hidden">Invalid credentials</div>
    </div>
  </div>

  <div id="appRoot" class="app hidden">
    <button class="hamburger app-hamburger" onclick="toggleSidebar('app')" aria-label="Toggle app menu">☰</button>
    <aside class="sidebar">
      <div class="brand">
        <div class="logo-wrap">
          <img src="/assets/logo.png" alt="AAI" class="logo-img" />
        </div>
        <div>
          <div class="brand-title">Arunand's ERP</div>
          <div class="brand-sub">Arunand's Aviation Institute</div>
        </div>
      </div>
      <nav class="nav">
        <button class="nav-item" data-section="feed">Feed</button>
        <button class="nav-item active" data-section="students">Students</button>
        <button class="nav-item" data-section="attendance">Attendance</button>
        <button class="nav-item" data-section="fees">Fees</button>
        <button class="nav-item" data-section="timetable">Timetable</button>
        <button class="nav-item" data-section="interviews">Interviews</button>
        <button class="nav-item" data-section="announcements">Announcements</button>
        <button class="nav-item" data-section="notifications">Notifications</button>
        <button class="nav-item" data-section="activity">Activity</button>
        <button class="nav-item" data-section="alumni">Alumni</button>
        <button class="nav-item" data-section="reports">Reports</button>
      </nav>
      <button id="logoutBtn" class="btn logout-btn" onclick="logout()">Logout</button>
      <div class="side-card">
        <div class="side-card-title">Today</div>
        <div class="side-card-row">
          <span>Active Batches</span>
          <strong id="batchCount">-</strong>
        </div>
        <div class="side-card-row">
          <span>Students</span>
          <strong id="studentCount">-</strong>
        </div>
      </div>
    </aside>

    <main class="main">
      <section id="section-students" class="section">
        <header class="topbar">
          <div>
            <h1>Student Management</h1>
            <p>Click a student to view attendance and fee status</p>
          </div>
          <div class="top-actions">
            <input id="search" class="search" placeholder="Search name or ID" />
            <button class="btn" onclick="loadStudents()">Refresh</button>
          </div>
        </header>

        <section class="grid">
          <div class="panel list-panel">
            <div class="panel-header">
              <h2>Students</h2>
              <span class="hint">Select to open profile</span>
            </div>
            <ul id="studentList" class="student-list"></ul>
          </div>

          <div class="panel detail-panel">
            <div class="panel-header">
              <div>
                <h2 id="detailName">Select a student</h2>
                <div id="detailMeta" class="meta">No student selected</div>
              </div>
            </div>

            <div class="metrics">
              <div class="metric">
                <div class="metric-label">Total Fee</div>
                <div id="metricTotal" class="metric-value">-</div>
              </div>
              <div class="metric">
                <div class="metric-label">Paid</div>
                <div id="metricPaid" class="metric-value">-</div>
              </div>
              <div class="metric">
                <div class="metric-label">Balance</div>
                <div id="metricBalance" class="metric-value">-</div>
              </div>
              <div class="metric">
                <div class="metric-label">Attendance</div>
                <div id="metricAttendance" class="metric-value">-</div>
              </div>
            </div>

            <div class="tabs">
              <button class="tab active" data-tab="attendance">Attendance</button>
              <button class="tab" data-tab="fees">Fees</button>
            </div>

            <div id="tab-attendance" class="tab-content">
              <table>
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Remarks</th>
                  </tr>
                </thead>
                <tbody id="attendanceBody">
                  <tr>
                    <td colspan="3" class="empty">No attendance loaded</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div id="tab-fees" class="tab-content hidden">
              <table>
                <thead>
                  <tr>
                    <th>Entry</th>
                    <th>Total</th>
                    <th>Paid</th>
                    <th>Due</th>
                    <th>Remarks</th>
                  </tr>
                </thead>
                <tbody id="feesBody">
                  <tr>
                    <td colspan="5" class="empty">No fees loaded</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <section id="addStudentPanel" class="panel add-panel">
          <div class="panel-header">
            <h2>Add Student</h2>
            <span class="hint">Quick enrollment</span>
          </div>
          <div class="form-row">
            <input id="name" placeholder="Student Name" />
            <input id="course" placeholder="Course (Ground/Cabin Crew)" />
            <input id="batch" placeholder="Batch (Mike/November/Oscar/Papa)" />
            <button class="btn primary" onclick="addStudent()">Add Student</button>
          </div>
        </section>
      </section>

      <section id="section-attendance" class="section hidden">
        <header class="topbar">
          <div>
            <h1 id="attendanceTitle">Attendance Overview</h1>
            <p id="attendanceSubtitle">Date-wise attendance across all students</p>
          </div>
          <div class="top-actions">
            <button class="btn" onclick="loadRecentAttendance()">Refresh</button>
          </div>
        </header>
        <section id="studentWelcomePanel" class="panel hidden">
          <div class="panel-header">
            <h2 id="studentWelcomeTitle">Hello</h2>
            <span class="hint">Your attendance summary</span>
          </div>
          <div class="attendance-hero">
            <div class="attendance-percent">
              <div class="attendance-percent-label">Attendance</div>
              <div id="attendancePercentValue" class="attendance-percent-value">--%</div>
            </div>
            <div class="meta">
              Welcome back. You can view your attendance records below.
            </div>
          </div>
        </section>
        <section id="takeAttendancePanel" class="panel">
          <div class="panel-header">
            <h2>Take Today's Attendance</h2>
            <span class="hint">Absent by default — toggle Present and add remarks</span>
          </div>
          <div class="form-row attendance-form">
            <div class="meta">Date: <strong id="todayAttendanceDate">-</strong></div>
            <button class="btn" onclick="renderTodayAttendance()">Load Students</button>
            <button class="btn primary" onclick="submitTodayAttendance()">Submit Today's Attendance</button>
          </div>
          <div class="attendance-meta">
            <span>Present: <strong id="todayPresentCount">0</strong></span>
            <span>Absent: <strong id="todayAbsentCount">0</strong></span>
          </div>
          <div class="attendance-list">
            <table>
              <thead>
                <tr>
                  <th>Student</th>
                  <th>Batch</th>
                  <th>Present</th>
                  <th>Remarks</th>
                </tr>
              </thead>
              <tbody id="todayAttendanceBody">
                <tr>
                  <td colspan="4" class="empty">Load today's student list</td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>
        <section class="panel">
          <div class="panel-header">
            <h2>Attendance Overview</h2>
            <span class="hint">Pick a date to view the list (online D1 data)</span>
          </div>
          <div class="form-row attendance-form">
            <input id="attendanceDate" type="date" />
            <button class="btn" onclick="loadAttendanceByDate()">View Date</button>
            <button class="btn" onclick="loadRecentAttendance()">Recent 20</button>
          </div>
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Student</th>
                <th>Status</th>
                <th>Remarks</th>
              </tr>
            </thead>
            <tbody id="recentAttendanceBody">
              <tr>
                <td colspan="4" class="empty">No attendance loaded</td>
              </tr>
            </tbody>
          </table>
        </section>
      </section>

      <section id="section-fees" class="section hidden">
        <header class="topbar">
          <div>
            <h1 id="feesTitle">Fees Overview</h1>
            <p id="feesSubtitle">Record fees paid for each student</p>
          </div>
          <div class="top-actions">
            <button id="feesRefreshBtn" class="btn" onclick="renderFeesEntryList()">Refresh</button>
          </div>
        </header>
        <section id="studentFeePanel" class="panel hidden">
          <div class="panel-header">
            <h2>Pay Remaining Fees</h2>
            <span class="hint">Student view</span>
          </div>
          <div class="metrics">
            <div class="metric">
              <div class="metric-label">Course</div>
              <div id="studentFeeCourse" class="metric-value">-</div>
            </div>
            <div class="metric">
              <div class="metric-label">Total Fee</div>
              <div id="studentFeeTotal" class="metric-value">-</div>
            </div>
            <div class="metric">
              <div class="metric-label">Paid</div>
              <div id="studentFeePaid" class="metric-value">-</div>
            </div>
            <div class="metric">
              <div class="metric-label">Remaining Amount</div>
              <div id="studentFeeRemaining" class="metric-value">-</div>
            </div>
          </div>
          <div class="panel">
            <div class="panel-header">
              <h2>Payment Window</h2>
              <span class="hint">Razorpay</span>
            </div>
            <div class="meta">
              <div id="studentGatewayStatus">Checking payment gateway...</div>
              <button id="payNowBtn" class="btn primary hidden" onclick="payNowRazorpay()">Pay Now</button>
            </div>
          </div>
        </section>
        <section id="backdateAttendancePanel" class="panel">
          <div class="panel-header">
            <h2>Take Past Attendance</h2>
            <span class="hint">Use for missed entries. Future dates are blocked.</span>
          </div>
          <div class="form-row attendance-form">
            <input id="backDate" type="date" />
            <button class="btn" onclick="renderBackAttendance()">Load Date</button>
            <button class="btn primary" onclick="submitBackAttendance()">Submit Backdated Attendance</button>
          </div>
          <div class="attendance-meta">
            <span>Present: <strong id="backPresentCount">0</strong></span>
            <span>Absent: <strong id="backAbsentCount">0</strong></span>
          </div>
          <div class="attendance-list">
            <table>
              <thead>
                <tr>
                  <th>Student</th>
                  <th>Batch</th>
                  <th>Present</th>
                  <th>Remarks</th>
                </tr>
              </thead>
              <tbody id="backAttendanceBody">
                <tr>
                  <td colspan="4" class="empty">Select a date to load students</td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>
        <section class="panel">
          <div class="panel-header">
            <h2>Fee Summary</h2>
            <span class="hint">Total, due, and transactions</span>
          </div>
          <div class="metrics">
            <div class="metric">
              <div class="metric-label">Total</div>
              <div id="feeSummaryTotal" class="metric-value">-</div>
            </div>
            <div class="metric">
              <div class="metric-label">Due</div>
              <div id="feeSummaryDue" class="metric-value">-</div>
            </div>
            <div class="metric">
              <div class="metric-label">Transactions</div>
              <div id="feeSummaryTransactions" class="metric-value">-</div>
            </div>
          </div>
          <div class="meta" id="paymentGatewayInfo">Payment gateway: coming soon</div>
        </section>
        <section id="adminFeesPanel" class="panel">
          <div class="panel-header">
            <h2>Record Fees</h2>
            <span class="hint">Upload a receipt with each payment</span>
          </div>
          <table>
            <thead>
              <tr>
                <th>Student</th>
                <th>Batch</th>
                <th>Total Fee</th>
                <th>Paid</th>
                <th>Receipt</th>
                <th>Remarks</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="feeEntryBody">
              <tr>
                <td colspan="7" class="empty">No students loaded</td>
              </tr>
            </tbody>
          </table>
        </section>
      </section>

      <section id="section-feed" class="section hidden">
        <header class="topbar">
          <div>
            <h1>Feed</h1>
            <p>Live summary of fees, interviews, announcements, and notifications</p>
          </div>
          <div class="top-actions">
            <button class="btn" onclick="loadFeed()">Refresh</button>
          </div>
        </header>
        <section class="grid">
          <div class="panel">
            <div class="panel-header"><h2>Fees</h2></div>
            <div class="metrics">
              <div class="metric"><div class="metric-label">Total</div><div id="feedFeesTotal" class="metric-value">-</div></div>
              <div class="metric"><div class="metric-label">Due</div><div id="feedFeesDue" class="metric-value">-</div></div>
              <div class="metric"><div class="metric-label">Transactions</div><div id="feedFeesTxn" class="metric-value">-</div></div>
            </div>
          </div>
          <div class="panel">
            <div class="panel-header"><h2>Interviews</h2></div>
            <ul id="feedInterviews" class="student-list"></ul>
          </div>
        </section>
        <section class="grid">
          <div class="panel">
            <div class="panel-header"><h2>Announcements</h2></div>
            <ul id="feedAnnouncements" class="student-list"></ul>
          </div>
          <div class="panel">
            <div class="panel-header"><h2>Notifications</h2></div>
            <ul id="feedNotifications" class="student-list"></ul>
          </div>
        </section>
      </section>

      <section id="section-timetable" class="section hidden">
        <header class="topbar">
          <div>
            <h1>Timetable</h1>
            <p>Class schedules by day and batch</p>
          </div>
          <div class="top-actions">
            <button class="btn" onclick="loadTimetable()">Refresh</button>
          </div>
        </header>
        <section id="adminTimetablePanel" class="panel">
          <div class="panel-header">
            <h2>Add Timetable Entry</h2>
          </div>
          <div class="form-row">
            <input id="ttTitle" placeholder="Title (e.g., Ground Ops)" />
            <input id="ttDay" placeholder="Day (Mon/Tue/...)" />
            <input id="ttStart" placeholder="Start (09:00)" />
            <input id="ttEnd" placeholder="End (10:30)" />
            <input id="ttCourse" placeholder="Course" />
            <input id="ttBatch" placeholder="Batch" />
            <input id="ttLocation" placeholder="Location" />
            <input id="ttInstructor" placeholder="Instructor" />
            <button class="btn primary" onclick="addTimetable()">Add</button>
          </div>
        </section>
        <section class="panel">
          <table>
            <thead>
              <tr><th>Day</th><th>Time</th><th>Title</th><th>Course</th><th>Batch</th><th>Location</th><th>Instructor</th></tr>
            </thead>
            <tbody id="timetableBody"><tr><td colspan="7" class="empty">No timetable entries</td></tr></tbody>
          </table>
        </section>
      </section>

      <section id="section-interviews" class="section hidden">
        <header class="topbar">
          <div>
            <h1>Interview Stats</h1>
            <p>Airline interview tracking</p>
          </div>
          <div class="top-actions">
            <button class="btn" onclick="loadInterviews()">Refresh</button>
          </div>
        </header>
        <section id="adminInterviewPanel" class="panel">
          <div class="panel-header"><h2>Add Interview Record</h2></div>
          <div class="form-row">
            <input id="ivAirline" placeholder="Airline Name" />
            <input id="ivDate" type="date" />
            <input id="ivNotes" placeholder="Notes" />
            <button class="btn primary" onclick="addInterview()">Add</button>
          </div>
        </section>
        <section class="panel">
          <table>
            <thead><tr><th>Student</th><th>Airline</th><th>Date</th><th>Notes</th></tr></thead>
            <tbody id="interviewBody"><tr><td colspan="4" class="empty">No interview records</td></tr></tbody>
          </table>
        </section>
      </section>

      <section id="section-announcements" class="section hidden">
        <header class="topbar">
          <div>
            <h1>Announcements</h1>
            <p>Institute-wide updates</p>
          </div>
          <div class="top-actions">
            <button class="btn" onclick="loadAnnouncements()">Refresh</button>
          </div>
        </header>
        <section id="adminAnnouncementPanel" class="panel">
          <div class="panel-header"><h2>Post Announcement</h2></div>
          <div class="form-row">
            <input id="anTitle" placeholder="Title" />
            <input id="anMessage" placeholder="Message" />
            <button class="btn primary" onclick="addAnnouncement()">Post</button>
          </div>
        </section>
        <section class="panel">
          <ul id="announcementList" class="student-list"></ul>
        </section>
      </section>

      <section id="section-notifications" class="section hidden">
        <header class="topbar">
          <div>
            <h1>Notifications</h1>
            <p>Personal and broadcast notifications</p>
          </div>
          <div class="top-actions">
            <button class="btn" onclick="loadNotifications()">Refresh</button>
          </div>
        </header>
        <section id="adminNotificationPanel" class="panel">
          <div class="panel-header"><h2>Create Notification</h2></div>
          <div class="form-row">
            <input id="ntTitle" placeholder="Title" />
            <input id="ntMessage" placeholder="Message" />
            <input id="ntTarget" placeholder="Target user (optional)" />
            <button class="btn primary" onclick="addNotification()">Send</button>
          </div>
        </section>
        <section class="panel">
          <ul id="notificationList" class="student-list"></ul>
        </section>
      </section>

      <section id="section-reports" class="section hidden">
        <header class="topbar">
          <div>
            <h1>Reports</h1>
            <p>Snapshot of training operations</p>
          </div>
          <div class="top-actions">
            <button class="btn" onclick="loadReports()">Refresh</button>
          </div>
        </header>
        <section class="grid">
          <div class="panel">
            <div class="panel-header">
              <h2>Totals</h2>
            </div>
            <div class="metrics">
              <div class="metric">
                <div class="metric-label">Students</div>
                <div id="reportStudents" class="metric-value">-</div>
              </div>
              <div class="metric">
                <div class="metric-label">Fees Total</div>
                <div id="reportFeesTotal" class="metric-value">-</div>
              </div>
              <div class="metric">
                <div class="metric-label">Fees Paid</div>
                <div id="reportFeesPaid" class="metric-value">-</div>
              </div>
            </div>
          </div>
          <div class="panel">
            <div class="panel-header">
              <h2>Attendance</h2>
            </div>
            <div class="metrics">
              <div class="metric">
                <div class="metric-label">Present</div>
                <div id="reportPresent" class="metric-value">-</div>
              </div>
              <div class="metric">
                <div class="metric-label">Absent</div>
                <div id="reportAbsent" class="metric-value">-</div>
              </div>
              <div class="metric">
                <div class="metric-label">Balance Due</div>
                <div id="reportBalance" class="metric-value">-</div>
              </div>
            </div>
          </div>
        </section>
      </section>

      <section id="section-activity" class="section hidden">
        <header class="topbar">
          <div>
            <h1>Activity Log</h1>
            <p>All in-app actions with date and time</p>
          </div>
          <div class="top-actions">
            <select id="activityFilter" onchange="loadActivityLogs()">
              <option value="all">All</option>
              <option value="attendance">Attendance</option>
              <option value="fees">Fees</option>
              <option value="admissions">Admissions</option>
              <option value="content">Content</option>
            </select>
            <button class="btn" onclick="loadActivityLogs()">Refresh</button>
          </div>
        </header>
        <section class="panel">
          <table>
            <thead>
              <tr>
                <th>Date/Time</th>
                <th>Action</th>
                <th>Description</th>
                <th>By</th>
                <th>Status</th>
                <th>Undo</th>
              </tr>
            </thead>
            <tbody id="activityBody">
              <tr>
                <td colspan="6" class="empty">No activity yet</td>
              </tr>
            </tbody>
          </table>
        </section>
      </section>

      <section id="section-alumni" class="section hidden">
        <header class="topbar">
          <div>
            <h1>Proud Alumni</h1>
            <p>Students marked as selected</p>
          </div>
          <div class="top-actions">
            <button class="btn" onclick="loadProudAlumni()">Refresh</button>
          </div>
        </header>
        <section class="panel">
          <ul id="portalAlumniList" class="student-list">
            <li class="student-item"><strong>No alumni updates yet</strong></li>
          </ul>
        </section>
      </section>
    </main>
  </div>

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
  <script src="/app.js"></script>
</body>

</html>
